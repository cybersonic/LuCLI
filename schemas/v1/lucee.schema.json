{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://lucli.dev/schemas/v1/lucee.schema.json",
  "title": "LuCLI Lucee Server Configuration",
  "description": "Configuration file for LuCLI-managed Lucee server instances (lucee.json).",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "name": {
      "type": "string",
      "description": "Human-friendly server name. Defaults to the project directory name when omitted.",
      "x-ui-tab": "General",
      "x-ui-order": 10
    },
    "version": {
      "type": "string",
      "description": "Lucee engine version to use for this server instance.",
      "default": "6.2.2.91",
      "x-ui-tab": "General",
      "x-ui-order": 20
    },
    "host": {
      "type": "string",
      "description": "Hostname to use when generating default URLs and (when https.enabled=true) the self-signed certificate SANs. Defaults to 'localhost' when omitted.",
      "default": "localhost",
      "x-ui-tab": "General",
      "x-ui-order": 30
    },
    "port": {
      "type": "integer",
      "description": "HTTP port for the server.",
      "default": 8080,
      "minimum": 1,
      "maximum": 65535,
      "x-ui-tab": "General",
      "x-ui-order": 40
    },
    "shutdownPort": {
      "type": "integer",
      "description": "Tomcat shutdown port. When omitted, LuCLI derives this from the HTTP port (typically port + 1000) while avoiding conflicts with other servers.",
      "minimum": 1,
      "maximum": 65535,
      "x-ui-tab": "General",
      "x-ui-order": 45
    },
    "webroot": {
      "type": "string",
      "description": "Path to the webroot for this server. Can be relative to the project directory.",
      "default": "./",
      "x-ui-tab": "General",
      "x-ui-order": 50
    },
    "openBrowser": {
      "type": "boolean",
      "description": "When true, LuCLI will try to open a browser to the server URL after startup.",
      "default": true,
      "x-ui-tab": "General",
      "x-ui-order": 55
    },
    "openBrowserURL": {
      "type": "string",
      "description": "Optional custom URL to open instead of the default computed URL. Empty string or omission means 'use default'.",
      "x-ui-tab": "General",
      "x-ui-order": 56
    },
    "monitoring": {
      "type": "object",
      "description": "Monitoring and JMX configuration.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable JMX monitoring for this server.",
          "default": true
        },
        "jmx": {
          "type": "object",
          "description": "JMX endpoint configuration.",
          "additionalProperties": false,
          "properties": {
            "port": {
              "type": "integer",
              "description": "JMX port for remote monitoring.",
              "default": 8999,
              "minimum": 1,
              "maximum": 65535
            }
          }
        }
      }
    },
    "jvm": {
      "type": "object",
      "description": "JVM options for the embedded Tomcat/Lucee server.",
      "additionalProperties": false,
      "properties": {
        "maxMemory": {
          "type": "string",
          "description": "Maximum heap size for the JVM (e.g. '512m', '2g'). Must match ^[1-9]\\d*(m|g)$ (e.g. '256m', '1g').",
          "pattern": "^[1-9]\\d*(m|g)$",
          "default": "512m"
        },
        "minMemory": {
          "type": "string",
          "description": "Initial heap size for the JVM (e.g. '128m'). Must match ^[1-9]\\d*(m|g)$ (e.g. '128m', '512m').",
          "pattern": "^[1-9]\\d*(m|g)$",
          "default": "128m"
        },
        "additionalArgs": {
          "type": "array",
          "description": "Additional raw JVM arguments appended to CATALINA_OPTS.",
          "items": {
            "type": "string"
          },
          "default": []
        }
      }
    },
    "urlRewrite": {
      "type": "object",
      "description": "Framework-style URL routing configuration.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable framework-style URL rewriting.",
          "default": true
        },
        "routerFile": {
          "type": "string",
          "description": "Central router file for handling all routes (e.g. 'index.cfm').",
          "default": "index.cfm"
        }
      }
    },
    "admin": {
      "type": "object",
      "description": "Lucee administrator exposure settings.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Whether the Lucee administrator is accessible.",
          "default": true
        },
        "password": {
          "type": "string",
          "description": "Administrator password. SECURITY WARNING: Using plain text passwords is strongly discouraged. Use environment variable syntax like ${LUCEE_ADMIN_PASSWORD} or ${LUCEE_ADMIN_PASSWORD:-defaultValue} instead to avoid committing secrets to version control.",
          "default": ""
        }
      }
    },
    "https": {
      "type": "object",
      "description": "Optional HTTPS configuration. When enabled, LuCLI adds an HTTPS Tomcat connector and generates a per-server PKCS12 keystore under the server instance directory.",
      "additionalProperties": false,
      "properties": {
        "enabled": {
          "type": "boolean",
          "description": "Enable HTTPS.",
          "default": false
        },
        "port": {
          "type": "integer",
          "description": "HTTPS port (defaults to 8443 when omitted).",
          "minimum": 1,
          "maximum": 65535
        },
        "redirect": {
          "type": "boolean",
          "description": "Redirect HTTP to HTTPS (defaults to true when https.enabled=true)."
        }
      }
    },
    "enableLucee": {
      "type": "boolean",
      "description": "Enable Lucee CFML engine and servlet mappings. When false, Tomcat serves only static content (e.g. HTML/HTM).",
      "default": true,
      "x-ui-tab": "General",
      "x-ui-order": 60
    },
    "enableREST": {
      "type": "boolean",
      "description": "Enable Lucee REST servlet mappings. When false, REST endpoints are disabled. Requires 'enableLucee' to be true.",
      "default": true,
      "x-ui-tab": "General",
      "x-ui-order": 70
    },
    "agents": {
      "type": "object",
      "description": "Named Java agents that can be toggled per server start.",
      "additionalProperties": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "enabled": {
            "type": "boolean",
            "description": "Whether this agent is enabled by default for this instance.",
            "default": false
          },
          "jvmArgs": {
            "type": "array",
            "description": "JVM arguments that activate/configure this agent (e.g. -javaagent:...).",
            "items": {
              "type": "string"
            },
            "default": []
          },
          "description": {
            "type": "string",
            "description": "Human-readable description of this agent."
          }
        }
      },
      "default": {}
    },
    "configurationFile": {
      "type": "string",
      "description": "Path to an external CFConfig JSON file (base configuration). May be relative to the project directory or an absolute path. This is loaded first as the foundation; values are then merged with the inline 'configuration' object."
    },
    "configuration": {
      "type": "object",
      "description": "Inline Lucee CFConfig configuration that overrides/extends the base from 'configurationFile'. The final merged result is written to lucee-server/context/.CFConfig.json on server start. The structure should match Lucee's .CFConfig.json format.",
      "additionalProperties": true
    },
    "envFile": {
      "type": "string",
      "description": "Optional path to a .env-style file that is loaded before environment variable substitution. When omitted or empty, LuCLI defaults to a file named '.\u0065nv' in the same directory as lucee.json. May be relative to the project directory or an absolute path.",
      "x-ui-tab": "Environment",
      "x-ui-order": 10
    },
    "envVars": {
      "type": "object",
      "description": "Additional environment variables to inject into the Tomcat process. Keys are environment variable names; values are strings that support `${VAR}` and `${VAR:-default}` substitution. Resolved values are passed to the child Java process via its environment.",
      "additionalProperties": {
        "type": "string"
      },
      "default": {},
      "x-ui-tab": "Environment",
      "x-ui-order": 20
    },
    "dependencies": {
      "type": "object",
      "description": "Production dependencies for this project. Keys are dependency names; values are either a shorthand version string or a full dependency descriptor object.",
      "additionalProperties": {
        "anyOf": [
          {
            "type": "string",
            "description": "Shorthand version string (e.g. '4.3.0')."
          },
          {
            "$ref": "#/definitions/dependency"
          }
        ]
      },
      "default": {}
    },
    "devDependencies": {
      "type": "object",
      "description": "Development-only dependencies for this project. Same structure as 'dependencies'.",
      "additionalProperties": {
        "anyOf": [
          {
            "type": "string",
            "description": "Shorthand version string (e.g. '4.3.0')."
          },
          {
            "$ref": "#/definitions/dependency"
          }
        ]
      },
      "default": {}
    },
    "dependencySettings": {
      "$ref": "#/definitions/dependencySettings"
    },
    "packages": {
      "$ref": "#/definitions/dependencySettings",
      "description": "Deprecated alias for 'dependencySettings'. Prefer 'dependencySettings' for new configurations."
    },
    "environments": {
      "type": "object",
      "description": "Named environment configurations that can override base settings. Use 'lucli server start --env <name>' or 'lucli deps install --env <name>' to apply an environment.",
      "additionalProperties": {
        "$ref": "#/definitions/environmentConfig"
      },
      "default": {}
    }
  },
  "definitions": {
    "dependency": {
      "type": "object",
      "description": "Configuration for a single dependency declared under 'dependencies' or 'devDependencies' in lucee.json.",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "description": "Dependency type. Common values include 'cfml', 'jar', 'java', and 'extension'.",
          "default": "cfml"
        },
        "version": {
          "type": "string",
          "description": "Version string, typically using semantic versioning (e.g. '1.0.0', '4.3.0')."
        },
        "source": {
          "type": "string",
          "description": "Source of the dependency. Common values include 'git', 'http', 'file', and 'maven'.",
          "default": "git"
        },
        "url": {
          "type": "string",
          "description": "Source URL for git/http/file based dependencies.",
          "format": "uri"
        },
        "ref": {
          "type": "string",
          "description": "Git reference (branch, tag, or commit hash).",
          "default": "main"
        },
        "subPath": {
          "type": "string",
          "description": "Optional subdirectory within the source that should be installed."
        },
        "installPath": {
          "type": "string",
          "description": "Installation path relative to the project directory."
        },
        "mapping": {
          "type": "string",
          "description": "Lucee mapping virtual path for CFML dependencies (e.g. '/framework')."
        },
        "path": {
          "type": "string",
          "description": "Local file system path for 'file' source dependencies."
        },
        "groupId": {
          "type": "string",
          "description": "Maven groupId for 'java' dependencies."
        },
        "artifactId": {
          "type": "string",
          "description": "Maven artifactId for 'java' dependencies."
        },
        "repository": {
          "type": "string",
          "description": "Custom Maven repository URL.",
          "format": "uri"
        },
        "id": {
          "type": "string",
          "description": "Extension ID for Lucee .lex extension dependencies."
        }
      }
    },
    "dependencySettings": {
      "type": "object",
      "description": "Global dependency installation behaviour for 'lucli deps install'.",
      "additionalProperties": false,
      "properties": {
        "installLocation": {
          "type": "string",
          "description": "Base directory (relative to the project) where dependencies are installed.",
          "default": "dependencies"
        },
        "autoInstallOnServerStart": {
          "type": "boolean",
          "description": "When true, dependencies are automatically installed when the server starts.",
          "default": true
        },
        "verifyIntegrity": {
          "type": "boolean",
          "description": "When true, verifies dependency checksums against the lock file.",
          "default": true
        },
        "pruneOnInstall": {
          "type": "boolean",
          "description": "When true, removes directories for dependencies that are no longer declared.",
          "default": false
        },
        "installMethod": {
          "type": "string",
          "description": "Install method. Common values include 'symlink' or 'copy'.",
          "default": "symlink"
        },
        "installDevDependencies": {
          "type": ["boolean", "null"],
          "description": "Override whether devDependencies should be installed for a given environment. When null, defaults to true except when --production is used."
        }
      }
    },
    "environmentConfig": {
      "type": "object",
      "description": "Environment-specific configuration overrides. Values are deep-merged into the base configuration when starting a server with --env or running 'lucli deps install --env'.",
      "additionalProperties": true,
      "properties": {
        "dependencySettings": {
          "$ref": "#/definitions/dependencySettings",
          "description": "Dependency installation overrides for this environment."
        },
        "packages": {
          "$ref": "#/definitions/dependencySettings",
          "description": "Deprecated alias for 'dependencySettings' for backwards compatibility."
        }
      }
    }
  }
}
